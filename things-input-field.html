<link rel="import" href="../polymer/polymer.html">

<dom-module id="things-input-field">
  <style>
    label{
      @apply(--things-label);
    }
    input{
      @apply(--things-input);
    }
    input:focus{
      outline:none;
    }
    .hint:before{
      @apply(--things-hint-arrow);
    }
    .hint{
      @apply(--things-hint);
    }
  </style>

  <template>
    <label>[[label]]</label>

    <input is="iron-input" id="input"
      name="[[name]]"
      type="[[type]]"
      bind-value="{{value}}"
      placeholder="[[placeholder]]"
      min="[[min]]"
      max="[[max]]"
      minlength$="[[minlength]]"
      maxlength$="[[maxlength]]"
      pattern$="[[pattern]]"
      allowed-pattern="[[allowedPattern]]"
      validator="[[validator]]"
      required$="[[required]]"
      hidden="[[hidden]]"
      readonly$="[[readonly]]"
      disabled="[[disabled]]"
      error-massage="[[errorMessage]]"
      auto-validate="[[autoValidate]]">

    <template is="dom-if" if="[[!isValid]]">
      <span class="hint">[[errorMessage]]</span>
    </template>
  </template>

  <script>
    Polymer({
      is: "things-input-field",

      behavior: [
        Polymer.IronFormElementBehavior
      ],

      properties: {
        
        /**
         * label string
         */
        label: {
          type: String
        },

        /**
         * input field name
         */
        name: {
          type: String
        },

        /**
         * allowd pattern
         * validation check의 기준이 되는 패턴의 정의 합니다.
         * ex [a-zA-Z]* a~z & A~Z 
         * 마지막 *을 포함하지 않을 시 validation에서 첫글자만 확인하는점 주의
         * pattern의 기준과 다른 문자열 입력 가능
         */
        pattern: {
          type: String
        },

        /**
         * input field에 입력 가능한 패턴을 정의 합니다.
         * pattern과 달리 입력이 안되도록 합니다.
         * ex: [a-zA-Z0-9] a ~ z, A ~ Z, 0 ~ 9
         * allowedPattern의 기준과 다른 문자열 입력 불가능
         */
        allowedPattern: {
          type: String
        },

        /**
         * input field value
         */
        value: {
          type: String,
          observer: '_valueChanged'
        },

        /**
         * input field placeholder
         */
        placeholder: {
          type: String
        },

        /**
         * input field type
         */
        type: {
          type: String
        },

        /**
         * 자동 validation check 활성화 여부
         */
        autoValidate: {
          type: Boolean,
          value: false
        },

        /**
         * type이 number일때 활성화 되며 최소값을 정의 합니다.
         */
        min: {
          type: Number
        },

        /**
         * type이 number일때 활성화 되며 최대값을 정의 합니다.
         */
        max: {
          type: Number
        },

        /**
         * type이 string일때 활성화 되며 입력 최소 길이를 정의 합니다.
         */
        minlength: {
          type: Number
        },

        /**
         * type이 string일때 활성화 되며 입력 최대 길이를 정의 합니다.
         */
        maxlength: {
          type: Number
        },

        /**
         * validate 함수를 통해 return 되는 값으로 초기화 하는 변수
         */
        isValid: {
          type: Boolean,
          value: true
        },

        /**
         * input field에 반드시 값이 포함되어야 함을 결정 합니다.
         */
        required: {
          type: Boolean,
          value: false
        },
        
        /**
         * input field hidden attribute
         */
        hidden: {
          type: Boolean,
          value: false
        },

        /**
         * input field readonly attribute
         */
        readonly: {
          type: Boolean,
          value: false
        },

        /**
         * input field disabled attribute
         */
        disabled: {
          type: Boolean,
          value: false
        },

        /**
         * validation check를 통해 isValid의 값이 false일때 화면에 나타나는 errorMessage
         */
        errorMessage: {
          type: String,
          value: 'Invalid input'
        }
      },

      /**
       * 수동 validation check function
       */
      validate: function() {
        this.isValid = this.$.input.validate();
      },
      
      /**
       * autoValidate가 true일 때 bindValue의 변화를 감지해 validate 함수를 호출 합니다.
       */
      _valueChanged: function(bindValue) {
        console.log('Bind Value : ' + bindValue);
        if(this.autoValidate) {
          this.isValid = this.$.input.validate();
        }
      }
    });
  </script>

</dom-module>